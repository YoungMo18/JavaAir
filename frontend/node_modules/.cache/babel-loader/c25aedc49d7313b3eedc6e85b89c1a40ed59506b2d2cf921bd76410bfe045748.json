{"ast":null,"code":"import React from\"react\";import{Routes,Route,Navigate,Outlet}from\"react-router-dom\";import{IntroPage}from\"./components/IntroPage\";import{LoginPage}from\"./components/LoginPage\";import{FlightPage}from\"./components/FlightPage\";import{SignUpPage}from\"./components/SignUpPage\";import{HistoryPage}from\"./components/HistoryPage\";import{PostPage}from\"./components/PostPage\";import{DetailFlightPage}from\"./components/DetailFlightPage\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function RequireAuth(_ref){let{allowedUserTypes}=_ref;const[isAuthenticated,setIsAuthenticated]=React.useState(false);const[userType,setUserType]=React.useState(\"\");const[loading,setLoading]=React.useState(true);React.useEffect(()=>{const checkSession=async()=>{try{const response=await fetch(\"/api/v3/users/myIdentity\",{credentials:\"include\"// Ensures session cookies are sent\n});const data=await response.json();if(data.status===\"loggedin\"){setIsAuthenticated(true);setUserType(data.userInfo.userType);}}catch(err){console.error(\"Error verifying session:\",err);}finally{setLoading(false);}};checkSession();},[]);if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});if(!isAuthenticated&&allowedUserTypes.includes(\"guest\"))return/*#__PURE__*/_jsx(Outlet,{});if(allowedUserTypes.includes(userType))return/*#__PURE__*/_jsx(Outlet,{});return/*#__PURE__*/_jsx(Navigate,{to:\"/login\"});}function App(props){return/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/intro\",element:/*#__PURE__*/_jsx(IntroPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/login\",element:/*#__PURE__*/_jsx(LoginPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",element:/*#__PURE__*/_jsx(SignUpPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/flight_detail/:flight\",element:/*#__PURE__*/_jsx(DetailFlightPage,{})}),/*#__PURE__*/_jsx(Route,{element:/*#__PURE__*/_jsx(RequireAuth,{allowedUserTypes:[\"user\",\"guest\"]}),children:/*#__PURE__*/_jsx(Route,{path:\"/book\",element:/*#__PURE__*/_jsx(FlightPage,{})})}),/*#__PURE__*/_jsx(Route,{element:/*#__PURE__*/_jsx(RequireAuth,{allowedUserTypes:[\"user\"]}),children:/*#__PURE__*/_jsx(Route,{path:\"/history\",element:/*#__PURE__*/_jsx(HistoryPage,{})})}),/*#__PURE__*/_jsx(Route,{element:/*#__PURE__*/_jsx(RequireAuth,{allowedUserTypes:[\"worker\"]}),children:/*#__PURE__*/_jsx(Route,{path:\"/post\",element:/*#__PURE__*/_jsx(PostPage,{})})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(Navigate,{to:\"/book\"})})]});}export default App;","map":{"version":3,"names":["React","Routes","Route","Navigate","Outlet","IntroPage","LoginPage","FlightPage","SignUpPage","HistoryPage","PostPage","DetailFlightPage","jsx","_jsx","jsxs","_jsxs","RequireAuth","_ref","allowedUserTypes","isAuthenticated","setIsAuthenticated","useState","userType","setUserType","loading","setLoading","useEffect","checkSession","response","fetch","credentials","data","json","status","userInfo","err","console","error","children","includes","to","App","props","path","element"],"sources":["/Users/muhammadputra/Desktop/JavaAir/frontend/src/App.js"],"sourcesContent":["import React from \"react\";\nimport { Routes, Route, Navigate, Outlet } from \"react-router-dom\";\nimport { IntroPage } from \"./components/IntroPage\";\nimport { LoginPage } from \"./components/LoginPage\";\nimport { FlightPage } from \"./components/FlightPage\";\nimport { SignUpPage } from \"./components/SignUpPage\";\nimport { HistoryPage } from \"./components/HistoryPage\";\nimport { PostPage } from \"./components/PostPage\";\nimport { DetailFlightPage } from \"./components/DetailFlightPage\";\n\nfunction RequireAuth({ allowedUserTypes }) {\n  const [isAuthenticated, setIsAuthenticated] = React.useState(false);\n  const [userType, setUserType] = React.useState(\"\");\n  const [loading, setLoading] = React.useState(true);\n\n  React.useEffect(() => {\n    const checkSession = async () => {\n      try {\n        const response = await fetch(\"/api/v3/users/myIdentity\", {\n          credentials: \"include\", // Ensures session cookies are sent\n        });\n        const data = await response.json();\n        if (data.status === \"loggedin\") {\n          setIsAuthenticated(true);\n          setUserType(data.userInfo.userType);\n        }\n      } catch (err) {\n        console.error(\"Error verifying session:\", err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    checkSession();\n  }, []);\n\n  if (loading) return <div>Loading...</div>;\n  if (!isAuthenticated && allowedUserTypes.includes(\"guest\")) return <Outlet />;\n  if (allowedUserTypes.includes(userType)) return <Outlet />;\n  return <Navigate to=\"/login\" />;\n}\n\nfunction App(props) {\n  return (\n    <Routes>\n      <Route path=\"/intro\" element={<IntroPage />} />\n      <Route path=\"/login\" element={<LoginPage />} />\n      <Route path=\"/signup\" element={<SignUpPage />} />\n      <Route path=\"/flight_detail/:flight\" element={<DetailFlightPage />} />\n      {/* Allow anyone except workers to access `/book` */}\n      <Route element={<RequireAuth allowedUserTypes={[\"user\", \"guest\"]} />}>\n        <Route path=\"/book\" element={<FlightPage />} />\n      </Route>\n      {/* Restrict `/history` to logged-in users only */}\n      <Route element={<RequireAuth allowedUserTypes={[\"user\"]} />}>\n        <Route path=\"/history\" element={<HistoryPage />} />\n      </Route>\n      {/* Restrict `/post` to workers only */}\n      <Route element={<RequireAuth allowedUserTypes={[\"worker\"]} />}>\n        <Route path=\"/post\" element={<PostPage />} />\n      </Route>\n      <Route path=\"*\" element={<Navigate to=\"/book\" />} />\n    </Routes>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}